<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.9.1 from src/site/markdown/unixsockets.md at 2021-04-15
 | Rendered using Apache Maven Fluido Skin 1.9
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.9.1" />
    <title>junixsocket &#x2013; Unix socket reference</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.9.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
    <script src="./js/apache-maven-fluido-1.9.min.js"></script>
  </head>
  <body class="topBarDisabled">
    <a href="https://github.com/kohlschutter/junixsocket">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png"
        alt="Fork me on GitHub">
    </a>
    <div class="container-fluid">
      <header>
        <div id="banner">
          <div class="pull-left"><div id="bannerLeft"><h2>junixsocket â€” Unix Domain Sockets for Java</h2>
</div>
</div>
          <div class="pull-right"></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2021-04-15<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 2.3.3</li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">Overview</li>
    <li><a href="index.html" title="Welcome"><span class="none"></span>Welcome</a></li>
    <li><a href="changelog.html" title="New & Noteworthy"><span class="none"></span>New & Noteworthy</a></li>
    <li><a href="quickstart.html" title="Quick Start"><span class="none"></span>Quick Start</a></li>
    <li><a href="compatibility.html" title="Compatibility"><span class="none"></span>Compatibility</a></li>
    <li><a href="dependency.html" title="Add junixsocket to your project"><span class="none"></span>Add junixsocket to your project</a></li>
    <li><a href="faq.html" title="FAQ"><span class="none"></span>FAQ</a></li>
   <li class="nav-header">Demo Code</li>
    <li><a href="demo.html" title="Command line demos"><span class="none"></span>Command line demos</a></li>
    <li><a href="junixsocket-demo/xref/index.html" title="Source reference"><span class="none"></span>Source reference</a></li>
    <li><a href="filedescriptors.html" title="Sending file descriptors"><span class="none"></span>Sending file descriptors</a></li>
    <li><a href="peercreds.html" title="Peer credentials"><span class="none"></span>Peer credentials</a></li>
   <li class="nav-header">For Developers</li>
    <li><a href="development.html" title="Developing junixsocket"><span class="none"></span>Developing junixsocket</a></li>
    <li class="active"><a href="#"><span class="none"></span>Unix Sockets Reference</a></li>
    <li><a href="customarch.html" title="Custom architectures"><span class="none"></span>Custom architectures</a></li>
    <li><a href="crosscomp.html" title="Cross-Compiling with crossclang"><span class="none"></span>Cross-Compiling with crossclang</a></li>
    <li><a href="eclipse.html" title="Developing with Eclipse"><span class="none"></span>Developing with Eclipse</a></li>
    <li><a href="release.html" title="Release Instructions"><span class="none"></span>Release Instructions</a></li>
   <li class="nav-header">Modules</li>
    <li><a href="junixsocket-common/index.html" title="junixsocket-common"><span class="none"></span>junixsocket-common</a></li>
    <li><a href="junixsocket-server/index.html" title="junixsocket-server"><span class="none"></span>junixsocket-server</a></li>
    <li><a href="junixsocket-rmi/index.html" title="junixsocket-rmi"><span class="none"></span>junixsocket-rmi</a></li>
    <li><a href="junixsocket-mysql/index.html" title="junixsocket-mysql"><span class="none"></span>junixsocket-mysql</a></li>
    <li><a href="junixsocket-core/index.html" title="junixsocket-core"><span class="none"></span>junixsocket-core</a></li>
    <li><a href="junixsocket-demo/index.html" title="junixsocket-demo"><span class="none"></span>junixsocket-demo</a></li>
    <li><a href="junixsocket-selftest/index.html" title="junixsocket-selftest"><span class="none"></span>junixsocket-selftest</a></li>
    <li><a href="junixsocket-dist/index.html" title="junixsocket-dist"><span class="none"></span>junixsocket-dist</a></li>
    <li><a href="junixsocket-native/index.html" title="junixsocket-native"><span class="none"></span>junixsocket-native</a></li>
    <li><a href="junixsocket-native-custom/index.html" title="junixsocket-native-custom"><span class="none"></span>junixsocket-native-custom</a></li>
    <li><a href="junixsocket-native-common/index.html" title="junixsocket-native-common"><span class="none"></span>junixsocket-native-common</a></li>
   <li class="nav-header">Project Documentation</li>
    <li><a href="project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
    <li><a href="project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
            <hr />
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn"  class="span10" >
<h1>Unix socket reference</h1>
<p>Unix sockets, UNIX-domain sockets, Unix domain protocol family, POSIX local inter-process communication socket, POSIX local IPC socket, AF_UNIX, PF_UNIX, PF_LOCAL, AF_FILE, PF_FILE &#x2014; all these terms more or less refer to the same concept &#x2014; a host-internal protocol and addressing scheme that is more or less like socket communication between computers on the Internet. Typically, but not always, Unix sockets are referenced by pathnames on the file system.</p>
<p>Unix sockets are available on a variety of platforms (including macOS and Linux), and they all differ a little in how they work.</p>
<p>Here are some references that may be useful to you.</p><section>
<h2><a name="man_pages"></a>man pages</h2>
<p>man pages are a great reference to know more about what your particular system understands and supports.</p>
<p>Try the following commands on your machine:</p>
<ul>

<li>man unix       (or: man 4 unix, man 7 unix)</li>
<li>man socket     (or: man 2 socket)</li>
<li>man socketpair</li>
<li>man af_local</li>
</ul>
<p>Make sure you follow the references to other man pages in the SEE ALSO sections of each man page.</p>
<p>You can also search for references to unix and socket in the man pages using the apropos command:</p>
<ul>

<li>apropos socket</li>
<li>apropos unix</li>
</ul>
<p>Here are some man pages on the web for different platforms:</p>
<ul>

<li>Linux: <a class="externalLink" href="http://man7.org/linux/man-pages/man7/unix.7.html">unix(7)</a>, <a class="externalLink" href="http://man7.org/linux/man-pages/man2/socket.2.html">socket(2)</a></li>
<li>macOS: <a class="externalLink" href="https://www.unix.com/man-page/mojave/4/unix/">unix(4)</a>, <a class="externalLink" href="https://www.unix.com/man-page/mojave/2/socket/">socket(2)</a></li>
<li>Illumos/OpenSolaris: <a class="externalLink" href="https://illumos.org/man/3socket/socket">socket(3SOCKET)</a>, <a class="externalLink" href="https://illumos.org/man/3HEAD/socket">socket(3HEAD)</a>.</li>
<li>FreeBSD: <a class="externalLink" href="https://www.freebsd.org/cgi/man.cgi?query=unix&amp;sektion=4">unix(4)</a>, <a class="externalLink" href="https://www.freebsd.org/cgi/man.cgi?query=socket&amp;sektion=2">socket(2)</a></li>
<li>The FreeBSD website also covers other operating systems. Just select the desired operating system from the drop-down menu (e.g., NetBSD, OpenBSD, HP-UX, 4.3BSD NET/2</li>
<li>z/OS: <a class="externalLink" href="https://www.ibm.com/support/knowledgecenter/en/SSLTBW_2.3.0/com.ibm.zos.v2r3.cbcpx01/adiucvd.htm">Addressing within the AF_UNIX domain</a>, <a class="externalLink" href="https://www.ibm.com/support/knowledgecenter/SSLTBW_2.3.0/com.ibm.zos.v2r3.cbcpx01/ssda.htm">Using z/OS UNIX sockets</a></li>
<li>POSIX: <a class="externalLink" href="https://www.unix.com/man-page/all/7P/unix/">7P unix</a>, <a class="externalLink" href="https://www.unix.com/man-page/all/3posix/socket/">3POSIX socket</a>, <a class="externalLink" href="https://www.unix.com/man-page/all/7posix/un.h/">7POSIX un.h</a></li>
<li>Also check out the <a class="externalLink" href="https://www.unix.com/man-page-repository.php">man page repository</a> on the unix.com website, which provides entire man page sets for different operating systems.</li>
<li>Windows: Since Build 17063 (Fall Creators Update?), even Microsoft Windows 10 supports AF_UNIX: <a class="externalLink" href="https://blogs.msdn.microsoft.com/commandline/2017/12/19/af_unix-comes-to-windows/">AF_UNIX comes to Windows</a>, <a class="externalLink" href="https://blogs.msdn.microsoft.com/commandline/2018/02/07/windowswsl-interop-with-af_unix/">Windows/WSL Interop with AF_UNIX</a> &#x2014; check availability using sc query afunix. The driver is afunix.sys, the headers are in &lt;afunix.h&gt;.</li>
<li>QNX Neutrino RTOS: <a class="externalLink" href="http://www.qnx.com/developers/docs/7.0.0/index.html#com.qnx.doc.neutrino.lib_ref/topic/u/unix_proto.html">unix_proto</a>, <a class="externalLink" href="http://www.qnx.com/developers/docs/7.0.0/index.html#com.qnx.doc.neutrino.lib_ref/topic/s/socket.html">socket</a></li>
</ul></section><section>
<h2><a name="Headers"></a>Headers</h2>
<p>You can&#x2019;t go wrong by looking at the system headers (maybe under /usr/include, or elsewhere on your system).</p>
<p>Look for the following userspace headers:</p>
<ul>

<li>&lt;sys/un.h&gt;</li>
<li>&lt;sys/socket.h&gt;.</li>
</ul>
<p>Here are some platform-specific references:</p>
<ul>

<li>Linux:
<ul>

<li>userspace headers are defined in glibc/dietlibc/musl, etc.</li>
<li><a class="externalLink" href="https://github.com/torvalds/linux/blob/master/net/unix/af_unix.c">kernel source</a></li>
</ul>
</li>
</ul>
<p>You may need to #define _GNU_SOURCE before importing these headers to unlock GNU-specific extensions.</p>
<ul>

<li>macOS: <a class="externalLink" href="http://newosxbook.com/src.jl?tree=xnu&amp;file=/bsd/sys/un.h">sys/un.h</a>, <a class="externalLink" href="http://newosxbook.com/src.jl?tree=xnu&amp;file=/bsd/sys/socket.h">sys/socket.h</a></li>
</ul>
<p>You may need to #define _DARWIN_C_SOURCE before importing these headers to unlock Darwin/macOS-specific extensions.</p>
<ul>

<li>Open Group Base Specification: <a class="externalLink" href="http://pubs.opengroup.org/onlinepubs/009604499/basedefs/sys/un.h.html">sys/un.h</a>, <a class="externalLink" href="http://pubs.opengroup.org/onlinepubs/009604499/basedefs/sys/socket.h.html">sys/socket.h</a></li>
<li>Windows: &lt;afunix.h&gt;</li>
</ul></section><section>
<h2><a name="Port_numbers"></a>Port numbers</h2>
<p>Unlike Internet socket addresses, Unix domain socket addresses do not support a numeric <i>port</i> component.</p>
<p><a class="externalLink" href="https://kohlschutter.github.io/junixsocket/">junixsocket</a> provides an API that shims in support for ports, in order to support Java RMI over Unix sockets, for example.</p></section><section>
<h2><a name="Other_references"></a>Other references</h2>
<ul>

<li>junixsocket&#x2019;s <a class="externalLink" href="https://github.com/kohlschutter/junixsocket/tree/master/junixsocket-native/src/main/c">JNI code</a></li>
<li>Wikipedia: <a class="externalLink" href="https://en.wikipedia.org/wiki/Unix_domain_socket">Unix domain socket</a></li>
</ul></section><section>
<h2><a name="Platform-specific_limits_and_extensions"></a>Platform-specific limits and extensions</h2><section>
<h3><a name="Length_of_a_socket_path_.28sun_path.29"></a>Length of a socket path (sun_path)</h3>
<p>Some operating systems, such as HP/UX, limit sun_path to only be up to 92 bytes. macOS, QNX and 4.4 BSD limit them to 104. Linux, 4.3 BSD and z/OS have a limit of 108 bytes. A mandatory terminating null byte is included in this calculation.</p></section><section>
<h3><a name="Socket_types"></a>Socket types</h3>
<p>Usually, all platforms support SOCK_STREAM (stream sockets), most support SOCK_DGRAM (datagram sockets), and some also support SOCK_SEQPACKET (sequenced packet socket with preserved message boundaries).</p></section><section>
<h3><a name="Abstract_namespace"></a>Abstract namespace</h3>
<p>Some platforms, such as Linux, QNX and Windows 10, support a namespace for sockets that is not connected to the filesystem. A socket is in the abstract namespace if it starts with a null byte &#x2014; the remainder of the data structure is part of the name, and null bytes may have no special meaning.</p>
<p>unlink upon destruction is typically not necessary for such sockets, and chmod/chown has no effect.</p>
<p>SUN_LEN probably shouldn&#x2019;t be used here to determine the length of the sockaddr_un since it uses strlen.</p>
<p>Some platforms (Linux only?) can automatically assign names in the abstract namespace by means of &#x201c;autobind&#x201d;, whereas the name commonly consists of the starting null byte followed by 5 bytes using hexadecimal characters (0-9, a-f).</p></section><section>
<h3><a name="Unnamed_sockets"></a>Unnamed sockets</h3>
<p>A pair of sockets can be created using socketpair, which may not always be supported.</p></section><section>
<h3><a name="Transmit_file_descriptors.2C_credentials"></a>Transmit file descriptors, credentials</h3>
<p>Ancillary messages / ancillary data allows passing special information over these sockets that is not just binary data. These messages are usually transmitted via sendmsg/recvmsg, and they&#x2019;re practically all very platform-specific.</p>
<ul>

<li>SCM_RIGHTS: Send or receive file descriptors (or more generically, &#x201c;access rights&#x201d;).</li>
</ul>
<p>The used data structures vary (e.g., struct cmsgcred, struct cmsghdr).</p>
<p>Since on UNIX, practically everything can be referenced through a file descriptor, this feature can be very powerful (e.g., see <a class="externalLink" href="https://medium.com/@spencerfricke/android-ahardwarebuffer-shared-memory-over-unix-domain-sockets-7b27b1271b36">Android AHardwareBuffer Shared Memory over Unix Domain Sockets</a>).</p>
<ul>

<li>SCM_CREDENTIALS/SCM_UCRED: Send process credentials (e.g., UID, GID, etc.), which can be used to authenticate a caller.</li>
</ul>
<p>In order to receive these credentials, the socket must have a SO_PASSCRED/SO_RECVUCRED option enabled. Also see the SOL_LOCAL-level socket options on FreeBSD and macOS, such as LOCAL_CRED, LOCAL_PEERCRED, LOCAL_PEERPID,  LOCAL_PEEREPID, LOCAL_PEERUUID, LOCAL_PEEREUUID, etc.</p>
<p>Note that authenticating using a particular PID may be insecure as PIDs may be reused for new processes.</p>
<p>The used data structures vary (e.g., struct xucred, struct ucred, ucred_t)</p></section><section>
<h3><a name="Socket_options"></a>Socket options</h3>
<ul>

<li>

<p>SOL_SOCKET level:</p>
<ul>

<li>SO_RCVBUF has no effect.</li>
<li>SO_SNDBUF imposes an upper limit for outgoing datagrams.</li>
<li>SO_PASSCRED/SO_RECVUCRED enables the receipt of file descriptors</li>
<li>SO_NOSIGPIPE disable raising the SIGPIPE signal upon broken pipe.</li>
</ul>
</li>
<li>

<p>SOL_LOCAL level (FreeBSD, macOS):</p>
<ul>

<li>LOCAL_CRED, LOCAL_PEERCRED, LOCAL_PEERPID,  LOCAL_PEEREPID, LOCAL_PEERUUID, LOCAL_PEEREUUID: Receive peer credentials</li>
</ul>
</li>
</ul></section><section>
<h3><a name="ioctls"></a>ioctls</h3>
<ul>

<li>FIONREAD/SIOCINQ: For stream sockets, returns the amount of unread bytes in the receive buffer. For datagram sockets, returns the size of either the next pending datagram, or all pending data. Note that the datagram size could be 0 bytes, so this is probably not a good replacement for select.</li>
</ul></section></section><section>
<h2><a name="Command-line_tools"></a>Command-line tools</h2>
<blockquote>

<p><b>NOTE:</b> Not all commands and options are available on all platforms.</p>
</blockquote><section>
<h3><a name="Enumerate_available_sockets"></a>Enumerate available sockets</h3>
<blockquote>

<p><b>NOTE:</b> On Linux, when showing abstract namespace paths, null bytes are converted to @. Older tool versions may not handle zero bytes properly.</p>
</blockquote><section>
<h4><a name="lsof"></a>lsof</h4>
<p>List unix sockets:</p>

<div>
<div>
<pre class="source">lsof -U
</pre></div></div>

<p>Also show peer processes/endpoints (Linux-only):</p>

<div>
<div>
<pre class="source">lsof +E -U
</pre></div></div>

<p>Combine with other parameters (and -a) to restrict to a particular user, process, etc., e.g., sudo lsof -a -U -u root</p></section><section>
<h4><a name="ss_.28Linux.29"></a>ss (Linux)</h4>
<p>List unix sockets:</p>

<div>
<div>
<pre class="source">ss -x
</pre></div></div>

<p>Also show peer processes/endpoints (it appears that your kernel needs to have UNIX_DIAG enabled for this.):</p>

<div>
<div>
<pre class="source">ss -xp
</pre></div></div>
</section><section>
<h4><a name="netstat"></a>netstat</h4>
<p>Show listening sockets:</p>

<div>
<div>
<pre class="source">netstat --unix -l
</pre></div></div>

<p>Show connected sockets:</p>

<div>
<div>
<pre class="source">netstat --unix
</pre></div></div>
</section><section>
<h4><a name="Filesystem"></a>Filesystem</h4>
<p>On Linux, you can get a list of all UNIX sockets:</p>

<div>
<div>
<pre class="source">cat /proc/net/unix
</pre></div></div>

<p>On Android, many sockets are defined in /dev/socket/.</p></section></section><section>
<h3><a name="Communicate_with_Unix_sockets"></a>Communicate with Unix sockets</h3><section>
<h4><a name="netcat_.2F_nc"></a>netcat / nc</h4>
<p>Connect to an existing stream socket</p>

<div>
<div>
<pre class="source">nc -U /path/to/ocket
</pre></div></div>

<p>Create a listening stream socket</p>

<div>
<div>
<pre class="source">nc -lU /path/to/socket
</pre></div></div>

<p>Datagrams</p>
<ul>

<li>Some versions of netcat support datagram sockets by adding another -u parameter.</li>
</ul></section><section>
<h4><a name="socat"></a>socat</h4>
<p>socat allows forwarding between two different sockets, as well as piping from and to STDIN, etc. (see man socat).</p>
<p>Check out the address types UNIX-CONNECT, UNIX-LISTEN, UNIX-SENDTO, UNIX-RECVFROM, UNIX-RECV, UNIX-CLIENT. On Linux, replace UNIX- by ABSTRACT-, and you can access sockets in the abstract namespace.</p>
<p>Example:</p>

<div>
<div>
<pre class="source">socat - UNIX-CONNECT:/path/to/socket
</pre></div></div>
</section><section>
<h4><a name="websocat"></a>websocat</h4>
<p>The socat-like tool for WebSockets also <a class="externalLink" href="https://github.com/vi/websocat/blob/master/doc.md">has support</a> for unix sockets.</p>
<p>Examples</p>
<ul>

<li>

<p>Websocket to Unix socket:</p>

<div>
<div>
<pre class="source">websocat ws-l:127.0.0.1:8088 unix:the_socket
</pre></div></div>
</li>
<li>

<p>Listen socket forwarding to Websocket:</p>

<div>
<div>
<pre class="source">websocat --unlink unix-l:the_socket ws://127.0.0.1:8089
</pre></div></div>
</li>
</ul></section><section>
<h4><a name="curl"></a>curl</h4>
<p>curl can send HTTP requests over Unix sockets. This is useful for communication with <a class="externalLink" href="https://www.docker.com/">Docker</a>, for example:</p>

<div>
<div>
<pre class="source">curl --unix-socket /var/run/docker.sock http://localhost/images/json
</pre></div></div>
</section></section></section><section>
<h2><a name="Servers"></a>Servers</h2><section>
<h3><a name="Webservers"></a>Webservers</h3>
<p>Web servers like <a class="externalLink" href="https://www.nginx.com/">nginx</a> provide support to serve content over unix sockets, and curl can be used to test them.</p></section><section>
<h3><a name="Databases"></a>Databases</h3>
<p>MySQL and PostgreSQL provide access to the database via Unix Sockets. Since the communication over TCP/IP usually requires SSL, this encryption can be disabled on the Unix domain socket connection, which should improve performance.</p>
<p><a class="externalLink" href="https://kohlschutter.github.io/junixsocket/">junixsocket</a> provides JDBC adapters for both.</p></section></section><section>
<h2><a name="Security"></a>Security</h2><section>
<h3><a name="File_permissions"></a>File permissions</h3>
<p>As a good practice, place unix sockets in a directory with tight access controls. On systems that support file-level controls on the socket itself, use chown/chmod to further restrict access, but do not rely on this alone.</p>
<p>Independent of directory-level access controls, the names of all unix sockets may be available through /proc/net/unix or similar APIs.</p></section><section>
<h3><a name="Abstract_namespace"></a>Abstract namespace</h3>
<p>Since there are no filesystem-level permission enforced upon socket names in the abstract namespace, one should consider them less secure than those specified by file path. Checking peer credentials upon establishing a connection (in <i>both</i> directions!) could make up for this, but that doesn&#x2019;t come for free.</p></section><section>
<h3><a name="Android"></a>Android</h3>
<p>The wild west. Applications with the INTERNET permission to access the Internet also have access to Unix domain sockets. A lot of sockets are unsecured.</p>
<p>See <a class="externalLink" href="http://web.eecs.umich.edu/~yurushao/pubs/sinspector_ccs2016.pdf">Yuru et al., The Misuse of Android Unix Domain Sockets and Security Implications</a> (with <a class="externalLink" href="http://web.eecs.umich.edu/~yurushao/pubs/sinspector_ccs2016_slides.pdf">presentation slides</a>) for an analysis of what can go wrong.</p>
<p>Also see <a class="externalLink" href="https://pdfs.semanticscholar.org/4c06/fab7c351851f5e13305ede29fd73cf1cf031.pdf">Jiang et al., Unix Domain Sockets Applied in Android Malware Should Not Be Ignored</a>.</p></section></section><section>
<h2><a name="Anything_missing_or_wrong.3F"></a>Anything missing or wrong?</h2>
<p>Feel free to reach out by email, <a class="externalLink" href="mailto:christian@kohlschutter.com">christian@kohlschutter.com</a>, or file an <a class="externalLink" href="https://github.com/kohlschutter/junixsocket/issues">issue</a> or <a class="externalLink" href="https://github.com/kohlschutter/junixsocket/pulls">pull request</a> with junixsocket.</p></section>
        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>&#169;      2009&#x2013;2021
<a href="https://www.kohlschutter.com/">KohlschÃ¼tter Search Intelligence</a>
</p>
        </div>
      </div>
    </footer>
  </body>
</html>